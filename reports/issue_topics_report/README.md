This folder contains a LaTeX writeup that consolidates the issue-topic clustering outputs
into a single document.

The pipeline runs and artifacts live on Greene/VAST; this repo stores:
- `report.tex` (generated by `scripts/build_issue_topics_latex_report.py`)
- `tables/*.tex` and `tables/*.csv` (generated)
- `figures/*.png` (copied from run outputs)

Typical flow (from a machine with access to the VAST paths, e.g. Greene):

```bash
python scripts/build_issue_topics_latex_report.py \
  --corpus-manifest /vast/.../merged_manifest.jsonl \
  --run full_ordinance:/vast/.../issue_topics_chunks3000_weight_full_ordinance_... \
  --run amendment_substantial:/vast/.../issue_topics_chunks3000_weight_amendment_substantial_... \
  --run amendment_targeted:/vast/.../issue_topics_chunks3000_weight_amendment_targeted_... \
  --output-dir reports/issue_topics_report \
  --top-clusters 15 \
  --include-scatter \
  --include-year-frequency-plots
```

Then compile locally:

```bash
cd reports/issue_topics_report
make
```

## Making the time-series plots readable

For top-k=50 “mountain” charts, the legend can overwhelm the plot if it sits inside the axes.
This repo’s plotting script supports placing the legend outside the plot area:

```bash
python scripts/plot_cluster_frequencies_over_time.py ... --legend-mode outside_bottom
```

If you want the plots to be as large as possible inside the compiled PDF, the LaTeX builder
supports a full-page figure mode:

```bash
python scripts/build_issue_topics_latex_report.py ... --figure-layout fullpage
```

## Rebuilding with a new cluster-labeling prompt (no reclustering)

UMAP/HDBSCAN clustering is driven by embeddings and does **not** depend on the cluster-labeling prompt.
If you want the same clusters/UMAPs but *better topic labels* (e.g. mechanics-aware v2 labels), you can:

1) Re-run cluster topic labeling into a new label directory (so you keep the old labels side-by-side).
2) Re-generate the labeled time-series plots using the new labels.
3) Rebuild the LaTeX bundle pointing at the new label + plot directories.

### 1) (Greene) Export + submit new cluster label batches

Example for one run root:

```bash
RUN_ROOT=/vast/.../issue_topics_chunks3000_weight_full_ordinance_YYYYMMDD_HHMMSS \
PROMPT_PATH=prompts/cluster_topic_labeler_prompt_text_mechanics_v2.txt \
SCHEMA_VERSION=v2 \
LABEL_DIR_NAME=cluster_topic_labels_mechanics_v2 \
OPENAI_MODEL=gpt-5-nano \
EXAMPLE_SELECTION=legacy \
CLUSTER_KEYWORDS_K=0 \
NO_MECHANICS_TAGS=1 \
sbatch slurm/export_and_submit_openai_cluster_topic_labels.sbatch
```

Notes:
- `LABEL_DIR_NAME=...` avoids overwriting existing `cluster_topic_labels/`.
- `CLUSTER_KEYWORDS_K=0` + `NO_MECHANICS_TAGS=1` makes prompts “examples-only” (no heuristic keyword/mechanics lines).

### 2) (Greene) Sweep results, rehydrate labels, and regenerate plots

```bash
RUN_ROOT=/vast/.../issue_topics_chunks3000_weight_full_ordinance_YYYYMMDD_HHMMSS \
LABEL_DIR_NAME=cluster_topic_labels_mechanics_v2 \
PLOT_DIR_NAME=plots_chunks_labeled_top50_noother_mechanics_v2 \
COUNT_MODE=weight \
WEIGHT_FIELD=doc_weight \
TOP_K=50 \
OMIT_OTHER=1 \
sbatch slurm/sweep_openai_cluster_topic_labels_results.sbatch
```

### 3) Build the LaTeX report pointing at the new dirs

```bash
python scripts/build_issue_topics_latex_report.py \
  --corpus-manifest /vast/.../merged_manifest.jsonl \
  --run full_ordinance:/vast/.../issue_topics_chunks3000_weight_full_ordinance_YYYYMMDD_HHMMSS \
  --run amendment_substantial:/vast/.../issue_topics_chunks3000_weight_amendment_substantial_YYYYMMDD_HHMMSS \
  --run amendment_targeted:/vast/.../issue_topics_chunks3000_weight_amendment_targeted_YYYYMMDD_HHMMSS \
  --output-dir /vast/.../issue_topics_report_latex_mechanics_v2_YYYYMMDD_HHMMSS \
  --top-clusters 15 \
  --include-scatter \
  --include-year-frequency-plots \
  --year-plot-dir-name plots_chunks_labeled_top50_noother_mechanics_v2 \
  --cluster-label-dir-name cluster_topic_labels_mechanics_v2 \
  --emit-year-counts-table
```

If you generated the report on Greene into a `/vast/.../issue_topics_report_latex_...` directory, you
can sync the whole bundle down and compile locally:

```bash
cd reports/issue_topics_report
make sync GREENE_REPORT_DIR=/vast/sxr203/newspaper-downloads/dedupe-webp/issue_topics_report_latex_YYYYMMDD_HHMMSS
make
```
